#sh
# The next line is executed by /bin/sh, but not Tcl \
exec tclsh $0 $1 $2 $3

if {$argc != 3} { 
  puts stderr "usage: gentex image_in text_in out.ps"
  exit 
}

set PINK "$env(PINK)"
source [file join "$PINK" "tcl" "my_exec.tcl"]
source [file join "$PINK" "tcl" "my_read.tcl"]
source [file join "$PINK" "tcl" "my_write.tcl"]

# get input image file name as first argument
set image_in [lindex $argv 0]
set text_in [lindex $argv 1]
set outfile [lindex $argv 2]

my_exec_v convert $image_in "genps_in.ps"
set text1 "\\documentclass{article}\\usepackage\[dvips\]{epsfig}\\usepackage\[latin1\]{inputenc}\\pagestyle{empty}\\begin{document}\\begin{figure}\[ht\]\\begin{center}\\psfig{figure="
set text2 ",width=\\linewidth}\\end{center}\\end{figure}\\begin{verbatim}\n"
set text3 "\\end{verbatim}\\end{document}"
set text [my_read_text $text_in]
append text1 "genps_in.ps" $text2 $text $text3
my_write_text "genps_out.tex" $text1
my_exec_v latex genps_out.tex
my_exec_v "dvips -o $outfile genps_out"
my_exec_v rm genps_out.tex
my_exec_v rm genps_out.log
my_exec_v rm genps_out.dvi
my_exec_v rm genps_in.ps
